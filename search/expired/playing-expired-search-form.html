<!--
`playing-expired-search-form`
@group Playing UI
@element playing-expired-search-form
-->
<dom-module id="playing-expired-search-form">
  <template>
    <style>
      *[role=widget] {
        margin-bottom: 16px;
      }

      label {
        @apply --nuxeo-label;
      }
    </style>

    <mostly-input role="widget"
            id="searchInput"
            label="[[i18n('defaultSearch.fullText')]]"
            value="{{searchTerm}}"
            placeholder="[[i18n('defaultSearch.fullText.placeholder')]]"
            autofocus>
    </mostly-input>

    <div role="widget">
      <label>[[i18n('defaultSearch.authors')]]</label>
      <mostly-dropdown-aggregation placeholder="[[i18n('defaultSearch.authors.placeholder')]]"
              data="[[aggregations.authors]]"
              value="{{params.authors}}"
              multiple="true">
      </mostly-dropdown-aggregation>
    </div>

  </template>

  <script>
    Polymer({
      is: 'playing-expired-search-form',
      behaviors: [Mostly.I18nBehavior],
      properties: {
        params: {
          type: Object,
          value: function() {
            var oneWeekAgo = new Date();
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
            return {
              "expiredMax" : oneWeekAgo.toJSON()
            }
          },
          notify: true
        },
        aggregations: {
          type: Object,
          value: {},
          notify: true
        },
        searchTerm: {
          type: String,
          notify: true,
          observer: '_addFullTextSearch'
        },
        minChars: {
          type: Number,
          value: 3
        }
      },

      _addFullTextSearch: function() {
        if (this.searchTerm && this.searchTerm.length >= this.minChars) {
          this.set('params.title', this.searchTerm);
        } else if (this.params.title) {
          this.set('params.title', '');
          delete this.params.title;
        }
      },

      clear: function() {
        this.searchTerm = '';
      }
    });
  </script>
</dom-module>
